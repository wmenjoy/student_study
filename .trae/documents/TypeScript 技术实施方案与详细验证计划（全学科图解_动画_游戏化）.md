## 技术栈
- 前端：TypeScript 5、React 18、Next.js（SSR+PWA，App Router）
- 状态与数据：Zustand（轻量状态）、Dexie（IndexedDB 本地持久化）、Workbox（Service Worker 离线缓存）
- 交互与可视化：SVG 优先（语义与可及性），Konva/Canvas（高密度交互），D3（图形/坐标/比例），Motion/GreenSock（动画）
- 模板与引擎：XState（关卡状态机）、统一模板/仿真引擎（图→式映射服务）
- 语音与可及性：Web Speech API（TTS）、axe-core（可及性测试）
- 国际化与样式：i18next（简体中文为主）、Tailwind + CSS 变量（色盲友好主题）
- 测试与质量：Vitest（单元/集成）、Playwright（E2E）、ESBuild/Vite（构建）、ESLint/Prettier

## 系统架构
- Monorepo（pnpm + Turborepo）：
  - `packages/ui`：基础UI与样式系统
  - `packages/interactive-templates`：比例条/数轴/拼板/树形/维恩图/天平/方程搭建器/笔画/词语
  - `packages/simulation-engine`：行程/工程/浓度/盈亏/概率/几何变换动画仿真
  - `packages/adaptive`：掌握度（BKT/ELO）、动态出题、错因诊断
  - `packages/content-dsl`：题型JSON/DSL Schema、校验器、映射器
  - `packages/data`：Dexie封装、离线同步、冲突解决
  - `apps/student`：学习端（Next.js PWA）
  - `apps/authoring`：Authoring Studio（内容制作与审校）
  - `apps/guardian`：家长/老师端报表

## 交互模板与仿真
- 模板组件（统一接口 `Template<TParams, TResult>`）：比例条、数轴、面积模型、天平、树形概率、维恩图、图形拼板、方程搭建器、笔画演示/跟写、词语小游戏、阅读标注
- 仿真引擎：行程相遇/追及、工程效率叠加、浓度混合/稀释、盈亏买卖、随机试验分布、几何变换；数值与动画双向绑定（Model-View 同步）
- 图→式映射：从交互状态生成口语解释与算式/方程；错误映射触发微指导脚本

## 内容DSL与生产
- 统一Schema：题干、素材、模板参数、正确性约束、错因映射、提示脚本、变式集合
- Authoring Studio：可视化编辑、自动校验（单位/边界/映射一致性）、版本与本地化管理（教材差异/术语映射）

## 自适应与错因
- 掌握度模型：节点初始化/更新/持久化，阈值默认0.8
- 动态出题：按掌握度与错因选择题型与难度，控制变式强度与题面多样性
- 错因库：≥3类常见错因（差倍混淆、单位遗漏、式子构造/优先级错误、图式到等式映射错误等）绑定微指导

## 数据与离线
- 本地：Dexie（学习进度、掌握度、作品、缓存内容包）
- 同步：增量合并（内容与学习记录），冲突提示与解决策略；隐私与监护合规

## 可及性与安全
- TTS 覆盖所有题干与提示；拼音辅助与逐字高亮
- 色盲友好主题与字体大小可调；键盘与触控导航
- 数据最小化、导出/删除、监护控制与审计日志

## 开发工作流
- 分支策略：main/dev/feature；PR强制CI（lint、test、build）
- 质量门槛：覆盖率≥80%、Playwright 核心路径必过、性能预算与可及性检查必过
- 指标埋点：关卡事件、教具操作、错因触发、微测结果、作品保存、家长端访问

## 实施里程碑
- W0–1：设计系统、DSL Schema、数据与埋点方案、Monorepo搭建
- W1–2：比例条/数轴/拼板模板v1、关卡状态机v1、行程仿真v1、笔画演示原型
- W3–6：差倍/行程专题闭环、笔画纠错与词语小游戏v1、家长报表v1
- W7–9：掌握度与动态出题、错因诊断、作品墙v1、离线同步v1
- W10–12：可及性与性能打磨、学习成效与A/B、发布与回滚

## 详细验证计划
- 单元/集成：模板逻辑、仿真数值、图→式映射、掌握度更新、动态出题、错因脚本（覆盖≥80%）
- E2E：核心学习路径跨设备与离线；作品保存/复盘；家长报表
- 可用性：儿童样本（10–20名）任务完成率与情绪观察、迭代调整
- 学习成效：前后测与迁移题正确率；专题掌握度达标与补练提升
- 性能与稳定：交互延迟<100ms、离线加载<2s、崩溃率与错误率达标、同步冲突可解≥95%
- 可及性与隐私：axe-core检查、TTS/拼音抽检、色盲主题对比度、数据最小化与监护流程

## Go/No-Go 门槛
- 学习：掌握度≥0.8占比≥70%，迁移正确率≥60%
- 参与：7日留存≥30%，会话≥12分钟，作品≥1/周
- 体验与性能：家长满意度≥4/5；交互延迟<100ms；离线加载<2s；错误率<1%
- 合规与可及性：隐私/监护合规；TTS/色盲/导航达标

## 需确认
- 目标平台优先（Web/移动/平板）与设备适配范围
- Authoring Studio 优先级与教研配置
- 年级覆盖节奏与奥数深度边界（入门/进阶）
- 课堂/家庭使用比例与班级管理范围