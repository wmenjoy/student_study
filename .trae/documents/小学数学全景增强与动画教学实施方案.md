# 目标与风格
- 身份：资深小学数学教师 + 前端动画设计师 +开发专家。
- 风格：卡通叙事、可操作教具、逐步动画、易错提示、微测闭环、创作工坊。
- 任务：在现有系统上扩展未覆盖的知识、完善动画演示与交互模板、增强微测与自适应。

# 新增内容版图（数学）
1) 数与运算（低年级核心）
- 进位与退位：列竖式加减法的“借位/进位”逐步动画（十进制方块/算盘）
- 乘法与除法：数组面积模型、部分积、平均分与分组（余数表现）
- 心算与估算：四舍五入、前后整、近似值动画刻度
- 因数倍数与整除：倍数条、因数树、整除判定（尾数/数字和）

2) 分数与小数
- 分数意义：分数圆/条形，分母切割、分子着色动画
- 分数等值：等分切割与合并、约分“折叠”动画
- 分数四则：同分母与异分母（LCM动画合并）
- 小数理解：百格小数点位置、与分数转化（百分网格）
- 小数四则与比较：数轴与位值高亮、对齐计算动画

3) 比与百分数（高年级过渡）
- 比的意义与化简：比例条+公因数缩放动画
- 百分数应用：百分网格+条形配比、打折、利率、税率

4) 量与几何
- 周长与面积：网格计数、切割与拼合“转化法”动画
- 体积与容积：方块体积、长方体展开图、加注水位条
- 角度与图形：量角器动画、旋转/平移/对称演示
- 坐标与地图：栅格坐标、比例尺、路线规划（简版最短路径）

5) 数据与概率
- 表格与统计图：条形/折线/饼图制作器，平均数与中位数动画
- 概率试验：重复试验频率曲线（收敛演示）

6) 应用题家族（扩展）
- 工程效率、浓度混合、盈亏买卖、鸡兔同笼、植树、行程、差倍、和差、移多补少、比多少、净重（已覆盖）
- 新增：流水行船（相对速度）、比例尺行程（坐标+比例）、时间与日历、钱币计算与找零

7) 奥数入门（循序渐进）
- 枚举与计数：乘法原理、加法原理、简单排容（图解）
- 奇偶与余数：取余与同余直观化、奇偶不变量
- 不变量与构造：改变与不变、“一步一步变”的动画
- 图论萌芽：度数、最短路径、树形结构（只做直观，不做复杂证明）

# 新增交互模板与动画引擎
- 位值方块与算盘：十进制方块（个十百），进退位拆合动画；算盘拨珠
- 竖式计算器：列式步骤动画（每一步高亮与口述）
- 百分网格与LCM合并：等分/合并条形与网格动画
- 量角器与尺子：拖拽测量工具、角度读数与刻度高亮
- 百格/数轴/坐标：通用刻度组件、拖拽点/线段、步长控制
- 钱币与购物：面值卡片、凑整与找零、优惠券动画
- 时间与日历：模拟时钟+数字时间条、跨日与跨小时演示
- 证明卡片（轻量）：“为什么对？”的三步解释卡（例/反例/直观）
- 动画编排器：统一时间线与事件（GSAP/Motion）驱动 StepPlayer；支持“下一步/上一步/朗读/重放/变式套用”。

# 页面结构与教学流程
- 引导（故事+目标+玩法）→ 操作（卡通对白+教具）→ 图→式（表达生成）→ 微测（3–5题）→ 复盘（总结+难度建议）
- 每页具备：变式面板（按掌握度）、分步演示（StepPlayer）、朗读（TTS）、微指导（儿童化语言）

# 自适应与错因库增强
- 技能图谱扩展：位值、进退位、等值分数、LCM、比例与百分网格、量角器读数、坐标与比例尺、钱币与找零
- 错因模式：
  - 进位忘记/借位方向错、对齐位错
  - 异分母加减未通分、约分错误
  - 百分数与小数换算错误、百分网格读数错
  - 量角器读数错误、坐标象限混淆、比例尺单位混乱
  - 钱币凑整与找零差错
- 策略：按错因触发“微指导+同构变式+更慢一步的引导动画”；掌握度达标阈值0.8，微测正确率≥80%入掌握。

# 语文联动（跨学科）
- 数学词汇卡片：进位/借位、等值、约分、通分、比例、百分、周长、面积、体积、坐标、角度等术语词卡与例句
- “把数学讲给朋友听”：口述转文字、自动润色与关键词高亮（逐步引入）

# 资产与美术
- 吉祥物扩展：机器人、恐龙、小鹿；主题皮肤（自然/太空/海洋）
- 插画背景：可拖拽开关（低端设备可关闭）
- 声效提示：成功/重试轻声效（可静音）

# 技术实现与架构增强
- 动画编排：GSAP/Motion统一时间线；StepPlayer支持“同步剧本”（每一步绑定教具状态）
- 教具库扩展：位值方块、竖式、百分网格、量角器、钱币、模拟时钟、日历、坐标尺
- DSL扩展：步骤脚本（每步目标/高亮/旁白）、资产引用、微测生成器、错因绑定
- PWA与性能：懒加载、素材打包、低端设备降级（关闭复杂背景与粒子动画）

# 微测题库生成规则（示例）
- 加法竖式：给出两数与列式；问每一列的进位与中间结果
- 分数加减：给出分数；问通分后的分母与等值分数；求最终和
- 百分网格：给出涂色比例；问对应百分与小数
- 量角器：给出角图；问读数与加减角度结果
- 坐标与比例尺：给定两点坐标/比例尺；问距离与实际长度
- 钱币：给定购物车；问最优凑整与找零

# 路线与里程碑
- SprintA：位值与竖式、百分网格/LCM、量角器与坐标尺、钱币与模拟时钟、动画编排器v1
- SprintB：页面与微测接入、错因库升级、作品工坊（孩子能“搭一题”）
- SprintC：奥数入门模块与更多变式、家长端策略建议、A/B校准

# 验证与指标
- 单元/集成：模板逻辑与动画状态同步覆盖≥80%
- E2E：核心路径与离线；微测正确率与掌握度提升曲线
- 可用性：儿童观察与任务完成率；情绪反馈
- 体验与性能：交互延迟<100ms、离线首屏<2s；可及性（TTS/对比度/键盘导航）

# 需要确认
- 优先接入的版块（建议先：位值与竖式、分数与百分网格、量角器与坐标尺、钱币与时间）
- 插画与音效的强度（默认轻量、可开关）
- 家长端希望看到的错因与建议维度（每周）

## 动画剧本模板（Storyboard）
- 竖式进/借位（VerticalAddSubAnimated）：
  - 场景：对齐列位 → 个位计算 → 进/借位标记 → 十位计算 → 百位计算 → 收尾总结
  - 关键帧：当前列高亮、上标“1”显示进位、借位斜线标记与改写、横线与结果出现、朗读每步口语
  - 旁白示例：
    - 对齐位：“把数字按个位、十位、百位排好，像好朋友站队一样。”
    - 个位：“先看个位，两个数相加，如果超过10，就向十位借一个‘十’。”
    - 传播：“进位就像送一个‘十’到隔壁，借位就像从隔壁拿回一个‘十’。”
- 分数通分与约分（FractionLCMAnimated）：
  - 场景：原分数条 → 分母分解/LCM → 条形细分到LCM → 等值分数着色 → 通分加/减 → GCD约分折叠
  - 关键帧：分割线逐步增加、等值分数数字高亮、叠加动画、份数折叠与最简显示
  - 旁白示例：
    - LCM：“找到两个分母都能一起‘平均分’的份数，就是最小公倍数。”
    - 约分：“把分子和分母一起缩小，像一起折纸，大小不变更好看。”

## 步骤DSL草案（Step DSL）
- 字段：
  - id：步骤唯一标识
  - title：步骤标题（短语）
  - say：旁白文本（可TTS）
  - highlight：高亮元素的选择器或键名
  - animate：动画动作数组（type、from、to、duration）
  - check：微测前置校验（表达式或函数引用）
  - next：下一步骤id
- 示例：
  - 竖式个位步骤：
    - id: step_ones
    - title: 个位计算
    - say: “先看个位，两个数相加，超过10就要进位。”
    - highlight: col_ones
    - animate: [{ type: "flash", target: "col_ones", duration: 400 }, { type: "showCarry", value: 1 }]
    - next: step_tens
  - 分数LCM步骤：
    - id: step_lcm
    - title: 求LCM
    - say: “把分母分解，找到最小公倍数。”
    - highlight: lcm_panel
    - animate: [{ type: "fadeIn", target: "lcm_panel", duration: 300 }]
    - next: step_refine

## 易错与微指导清单
- 竖式：
  - 错因：位不对齐、忘进位、借位方向错误、跨列误加
  - 指导：
    - 位对齐：“同一列像同一组队员，不能串队。”
    - 进位提醒：“个位超过10，就向十位送一个‘十’。”
    - 借位提醒：“这一位不够，向左边借一个‘十’再来计算。”
- 分数：
  - 错因：未通分直接加减、等值分数求错、约分只除分子或只除分母
  - 指导：
    - 通分：“先一起细分到LCM份，再加减。”
    - 等值：“分子分母同时乘同一个数，大小不变。”
    - 约分：“分子分母同时除以GCD，才能最简。”
- 量角器：零线未对齐、读数方向错误
- 比例尺：未统一单位、比例误解成倍数相加
- 钱币：最优凑整未考虑、找零面值错误

## 儿童语言风格与提示规范
- 词语：温暖、鼓励、动作化（送一个十、一起折纸、站队对齐）
- 句式：短句为主、逐句提示、避免术语堆砌
- 反馈：即时肯定、错误不惩罚，给出下一步建议与变式题

## 可及性与动效预算
- TTS覆盖率100%，支持朗读旁白与步骤
- 色盲友好与对比度达标；动效时间<600ms，允许关闭插画与复杂动效
- 键盘/触控导航：按步骤可操作，按钮与滑块命名清晰

## 数据埋点与指标字典
- 埋点：进入/完成/失败、变式选择、微测提交、错因标签、朗读点击、步骤切换
- 指标：掌握度曲线、微测正确率、错因Top、步骤停留时长、主动重试次数

## 家长端报表草案
- 主题：孩子近期掌握情况、错因与建议练习包、作品展示
- 可视化：技能雷达、错因分布、学习时段、动手次数与作品数量

## 内容制作工作流
- Authoring Studio：
  - 模板选取→步骤编排→旁白写作→微测生成→预览与校验→发布
- 校验：单位一致、边界值、LCM/GCD正确性、位对齐规则
- A/B：变式质量与学习增益评估，微指导语言对照实验

## QA测试矩阵（要点）
- 单元：carry/borrow、lcm/gcd、比例尺换算、标点判定
- 集成：StepPlayer与动画状态一致、朗读与步骤联动、变式与微测生成正确
- E2E：核心学习流程、跨设备与离线、低端设备降级

## 里程碑任务清单（落地）
- 竖式进/借位动画：
  - 组件与页面接入、步骤剧本与旁白、微测与错因绑定、变式题库
- 分数LCM动画：
  - 组件与页面接入、LCM/GCD函数与可视化、微测与错因绑定、变式题库
- 量角器与比例尺深化：
  - 工具精度与引导、错误读数提示、单位统一检查
- 钱币与购物：
  - 找零最优策略与多面值组合、微测与家庭场景化题面
- 家长端简版：
  - 报表模板与建议练习包、周报生成

## 发布与回滚
- 灰度发布，白名单用户；指标达标后逐步放量
- 功能开关与版本回退；数据迁移可逆，日志与告警齐备
