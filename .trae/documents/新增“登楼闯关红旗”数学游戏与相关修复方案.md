## 游戏概念与规则
- 模式：登楼到顶或逐关闯关，通关获🚩红旗；累计到一定数量即“登顶”。
- 每关包含一个小数学游戏（加/减/乘/除或应用题），按年级分层；闯关失败可重试并给提示。
- 进度与难度：使用现有自适应系统动态调整难度，记录闯关进度与旗帜数。

## 年级与难度设计
- 年级分层：一年级（10内加减）、二年级（100内加减与竖式）、三年级（乘除表）、四年级（两步混合）、五年级（比例/行程入门）、六年级（常见应用题）。
- 难度档位：easy/medium/hard（题目范围、步数或条件复杂度递增）。
- 结合现有 `nextExercise()` 输出难度等级，按年级映射到具体题型与参数范围。

## 技术实现
- 新路由：`/games/stair-quest`（Next.js App Router）。页面用 `LessonRunner` 组织“引导/操作/图→式/微测/复盘”流程。
- 可视化：复用 `components/Stairs.tsx` 展示楼层、每层时间与进度（apps/student/components/Stairs.tsx:4-73,76-137）。闯关推进时同步 `progress`。
- 奖励展示：在 `LessonShell.action` 位置显示🚩累计（参考星星展示逻辑 apps/student/components/LessonRunner.tsx:84-85,29-43）。
- 题库生成：新增 `lib/miniGames.ts`（年级→题型→生成器），优先复用现有组件：
  - 加减：`VerticalAddSub.tsx`
  - 数轴/数感：`NumberLine.tsx`
  - 倍数比例：`RatioBar.tsx`
  - 行程入门：`JourneySim.tsx`
  - 基础微测：使用 `MicroQuiz` 格式生成输入题项
- 状态推进：沿用 `LessonRunner` 的状态机（apps/student/components/LessonRunner.tsx:24-43,75-81）。过关时触发评估、加旗、取下一关难度。

## 数据与存储
- 进度：使用 IndexedDB `db.progress` 记录 `{ id:"stair-quest:<profile>", lesson:"stair-quest", state:"level=<n>;flags=<m>" }`